---
import { Globe } from 'lucide-astro';

export interface Props {
  lang: 'en' | 'pl' | 'de';
  pathMap: {
    en: string;
    pl: string;
    de: string;
  };
  mobile?: boolean;
}

const { lang, pathMap, mobile = false } = Astro.props;
---

{
  mobile ? (
    <nav class="language-flags" aria-label="Language">
      <a
        href={pathMap.en}
        aria-current={lang === 'en' ? 'page' : undefined}
        class:list={['flag-link', { active: lang === 'en' }]}
        title="English"
      >
        ðŸ‡¬ðŸ‡§
      </a>
      <a
        href={pathMap.pl}
        aria-current={lang === 'pl' ? 'page' : undefined}
        class:list={['flag-link', { active: lang === 'pl' }]}
        title="Polski"
      >
        ðŸ‡µðŸ‡±
      </a>
      <a
        href={pathMap.de}
        aria-current={lang === 'de' ? 'page' : undefined}
        class:list={['flag-link', { active: lang === 'de' }]}
        title="Deutsch"
      >
        ðŸ‡©ðŸ‡ª
      </a>
    </nav>
  ) : (
    <details class="language-switcher" aria-label="Language">
      <summary class="language-trigger" aria-label="Change language">
        <Globe size={18} />
      </summary>
      <div class="language-menu" role="menu">
        <a
          role="menuitem"
          href={pathMap.en}
          aria-current={lang === 'en' ? 'true' : 'false'}
          class="lang-item"
        >
          EN
        </a>
        <a
          role="menuitem"
          href={pathMap.pl}
          aria-current={lang === 'pl' ? 'true' : 'false'}
          class="lang-item"
        >
          PL
        </a>
        <a
          role="menuitem"
          href={pathMap.de}
          aria-current={lang === 'de' ? 'true' : 'false'}
          class="lang-item"
        >
          DE
        </a>
      </div>
    </details>
  )
}

<style>
  .language-switcher {
    position: relative;
    display: inline-block;
  }

  .language-switcher summary::-webkit-details-marker {
    display: none;
  }

  .language-trigger {
    list-style: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: var(--radius-m);
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .language-trigger:hover {
    background: var(--muted);
  }

  .language-trigger:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  .language-menu {
    position: absolute;
    right: 0;
    top: calc(100% + 10px);
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-l);
    box-shadow: var(--shadow-2);
    padding: var(--space-2);
    display: grid;
    gap: var(--space-1);
    min-width: 140px;
    z-index: 1000;
  }

  .lang-item {
    text-decoration: none;
    color: var(--text);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-m);
    transition: background-color 0.2s;
    font-size: var(--font-size-sm);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .lang-item[aria-current='true'] {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
  }

  .lang-item:hover {
    background: var(--muted);
  }

  .lang-item[aria-current='true']:hover {
    background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
  }

  /* Mobile flag styles */
  .language-flags {
    display: flex;
    gap: var(--space-2);
    align-items: center;
  }

  .flag-link {
    font-size: 1.5rem;
    text-decoration: none;
    padding: var(--space-1);
    border-radius: var(--radius-m);
    transition: all 0.2s ease;
    opacity: 0.6;
  }

  .flag-link:hover {
    opacity: 1;
    transform: scale(1.1);
  }

  .flag-link.active {
    opacity: 1;
    background: linear-gradient(
      135deg,
      oklch(from var(--primary) l c h / 0.15) 0%,
      oklch(from var(--accent) l c h / 0.1) 100%
    );
  }
</style>
