---
// Text Compare Component - Client-side only, lazy loaded
---

<div class="text-compare-wrapper">
  <div class="tool-header">
    <h2>Text Compare</h2>
    <p class="tool-description">
      Compare two texts side-by-side with highlighted differences. Perfect for
      code reviews and document comparison.
    </p>
  </div>

  <div class="compare-controls">
    <button id="clear-both" class="control-button">Clear Both</button>
    <button
      id="swap-texts"
      class="control-button"
      title="Swap Text A and Text B"
    >
      â‡„ Swap
    </button>
    <div class="view-toggle">
      <button
        id="view-combined"
        class="view-button active"
        data-view="combined"
      >
        Combined
      </button>
      <button
        id="view-side-by-side"
        class="view-button"
        data-view="side-by-side"
      >
        Side by Side
      </button>
    </div>
    <label class="line-numbers-toggle">
      <input type="checkbox" id="compare-line-numbers" checked />
      <span>Show line numbers</span>
    </label>
  </div>

  <!-- Combined View -->
  <div id="combined-view" class="diff-view active">
    <div class="diff-result">
      <div class="panel-header">
        <span>Differences (Combined View)</span>
      </div>
      <div class="diff-wrapper">
        <div id="diff-line-numbers-combined" class="line-numbers-combined">
        </div>
        <div id="diff-output-combined" class="diff-output"></div>
      </div>
    </div>
  </div>

  <!-- Side-by-Side View -->
  <div id="side-by-side-view" class="diff-view">
    <div class="text-compare-container">
      <div class="compare-panel">
        <div class="panel-header">
          <span>Text A (Old)</span>
          <button id="copy-text-a" class="copy-button" title="Copy Text A">
            Copy
          </button>
        </div>
        <div class="compare-wrapper">
          <div id="compare-line-numbers-a" class="line-numbers"></div>
          <div id="text-a-display" class="compare-display"></div>
        </div>
      </div>

      <div class="compare-panel">
        <div class="panel-header">
          <span>Text B (New)</span>
          <button id="copy-text-b" class="copy-button" title="Copy Text B">
            Copy
          </button>
        </div>
        <div class="compare-wrapper">
          <div id="compare-line-numbers-b" class="line-numbers"></div>
          <div id="text-b-display" class="compare-display"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Panels (always visible) -->
  <div class="text-compare-inputs">
    <div class="compare-panel">
      <div class="panel-header">
        <span>Text A</span>
        <button id="copy-text-a-input" class="copy-button" title="Copy Text A">
          Copy
        </button>
      </div>
      <div class="compare-wrapper">
        <div id="compare-line-numbers-a-input" class="line-numbers"></div>
        <textarea
          id="text-a"
          class="compare-input"
          placeholder="Enter first text here..."></textarea>
      </div>
    </div>

    <div class="compare-panel">
      <div class="panel-header">
        <span>Text B</span>
        <button id="copy-text-b-input" class="copy-button" title="Copy Text B">
          Copy
        </button>
      </div>
      <div class="compare-wrapper">
        <div id="compare-line-numbers-b-input" class="line-numbers"></div>
        <textarea
          id="text-b"
          class="compare-input"
          placeholder="Enter second text here..."></textarea>
      </div>
    </div>
  </div>
</div>

<script>
  import { diffLines } from 'diff';

  function initTextCompare() {
    const textA = document.getElementById('text-a') as HTMLTextAreaElement;
    const textB = document.getElementById('text-b') as HTMLTextAreaElement;
    const diffOutputCombined = document.getElementById('diff-output-combined');
    const diffLineNumbersCombined = document.getElementById(
      'diff-line-numbers-combined',
    );
    const textADisplay = document.getElementById('text-a-display');
    const textBDisplay = document.getElementById('text-b-display');
    const lineNumbersToggle = document.getElementById(
      'compare-line-numbers',
    ) as HTMLInputElement;
    const lineNumbersA = document.getElementById('compare-line-numbers-a');
    const lineNumbersB = document.getElementById('compare-line-numbers-b');
    const lineNumbersAInput = document.getElementById(
      'compare-line-numbers-a-input',
    );
    const lineNumbersBInput = document.getElementById(
      'compare-line-numbers-b-input',
    );
    const clearBothBtn = document.getElementById('clear-both');
    const swapTextsBtn = document.getElementById('swap-texts');
    const copyTextABtn = document.getElementById('copy-text-a');
    const copyTextBBtn = document.getElementById('copy-text-b');
    const copyTextAInputBtn = document.getElementById('copy-text-a-input');
    const copyTextBInputBtn = document.getElementById('copy-text-b-input');
    const viewCombinedBtn = document.getElementById('view-combined');
    const viewSideBySideBtn = document.getElementById('view-side-by-side');
    const combinedView = document.getElementById('combined-view');
    const sideBySideView = document.getElementById('side-by-side-view');

    if (!textA || !textB || !diffOutputCombined) return;

    // Bind line number scroll sync
    if (lineNumbersAInput) bindLineNumberScroll(textA, lineNumbersAInput);
    if (lineNumbersBInput) bindLineNumberScroll(textB, lineNumbersBInput);
    if (textADisplay && lineNumbersA)
      bindLineNumberScroll(textADisplay as HTMLElement, lineNumbersA);
    if (textBDisplay && lineNumbersB)
      bindLineNumberScroll(textBDisplay as HTMLElement, lineNumbersB);
    if (diffOutputCombined && diffLineNumbersCombined) {
      bindLineNumberScroll(
        diffOutputCombined as HTMLElement,
        diffLineNumbersCombined as HTMLElement,
      );
    }

    let currentView: 'combined' | 'side-by-side' = 'combined';

    function updateLineNumbers(
      text: string,
      lineNumbersEl: HTMLElement | null,
    ) {
      if (!lineNumbersEl) return;
      const lines = text.split('\n').length || 1;
      lineNumbersEl.innerHTML = Array.from({ length: lines }, (_, i) => i + 1)
        .map(num => `<div>${num}</div>`)
        .join('');
    }

    function escapeHtml(text: string): string {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function bindLineNumberScroll(
      contentEl: HTMLElement,
      gutterEl: HTMLElement,
    ) {
      let raf = 0;
      const sync = () => {
        raf = 0;
        gutterEl.scrollTop = contentEl.scrollTop;
      };

      contentEl.addEventListener(
        'scroll',
        () => {
          if (raf) return;
          raf = requestAnimationFrame(sync);
        },
        { passive: true },
      );

      gutterEl.addEventListener(
        'wheel',
        e => {
          e.preventDefault();
          contentEl.scrollTop += e.deltaY;
        },
        { passive: false },
      );
    }

    // Combined view (like Bitbucket combined diff)
    function updateCombinedView() {
      if (!diffOutputCombined) return;

      const textAValue = textA.value;
      const textBValue = textB.value;

      if (!textAValue && !textBValue) {
        diffOutputCombined.innerHTML =
          '<p class="diff-placeholder">Enter text in both fields to see differences</p>';
        if (diffLineNumbersCombined) diffLineNumbersCombined.innerHTML = '';
        return;
      }

      const diffs = diffLines(textAValue, textBValue);
      const fragment = document.createDocumentFragment();
      const lineNumberElements: (string | HTMLElement)[] = [];

      let oldLineNum = 0;
      let newLineNum = 0;

      diffs.forEach(part => {
        // Split by newline
        const lines = part.value.split('\n');

        // Process each line, handling empty lines correctly
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          // Skip the last empty line if it's just a trailing newline from split
          if (
            i === lines.length - 1 &&
            line === '' &&
            !part.value.endsWith('\n')
          ) {
            continue;
          }

          const lineDiv = document.createElement('div');
          lineDiv.className = 'diff-line';

          if (part.added) {
            newLineNum++;
            lineDiv.className += ' diff-line-added';
            lineDiv.innerHTML = `<span class="diff-line-marker">+</span><span class="diff-line-content">${escapeHtml(line)}</span>`;
            const lineNumDiv = document.createElement('div');
            lineNumDiv.className = 'line-num-new';
            lineNumDiv.textContent = newLineNum.toString();
            lineNumberElements.push(lineNumDiv);
          } else if (part.removed) {
            oldLineNum++;
            lineDiv.className += ' diff-line-removed';
            lineDiv.innerHTML = `<span class="diff-line-marker">-</span><span class="diff-line-content">${escapeHtml(line)}</span>`;
            const lineNumDiv = document.createElement('div');
            lineNumDiv.className = 'line-num-old';
            lineNumDiv.textContent = oldLineNum.toString();
            lineNumberElements.push(lineNumDiv);
          } else {
            oldLineNum++;
            newLineNum++;
            lineDiv.className += ' diff-line-unchanged';
            lineDiv.innerHTML = `<span class="diff-line-marker"> </span><span class="diff-line-content">${escapeHtml(line)}</span>`;
            const lineNumDiv = document.createElement('div');
            lineNumDiv.className = 'line-num-both';

            const oldSpan = document.createElement('span');
            oldSpan.className = 'line-num-old-value';
            oldSpan.textContent = oldLineNum.toString();

            const newSpan = document.createElement('span');
            newSpan.className = 'line-num-new-value';
            newSpan.textContent = newLineNum.toString();

            lineNumDiv.appendChild(oldSpan);
            lineNumDiv.appendChild(newSpan);

            lineNumberElements.push(lineNumDiv);
          }

          fragment.appendChild(lineDiv);
        }
      });

      diffOutputCombined.innerHTML = '';
      diffOutputCombined.appendChild(fragment);

      // Update combined line numbers (old/new format)
      if (diffLineNumbersCombined && lineNumbersToggle?.checked) {
        diffLineNumbersCombined.innerHTML = '';
        lineNumberElements.forEach(element => {
          if (typeof element === 'string') {
            diffLineNumbersCombined.innerHTML += element;
          } else {
            diffLineNumbersCombined.appendChild(element);
          }
        });
      } else if (diffLineNumbersCombined) {
        diffLineNumbersCombined.innerHTML = '';
      }
    }

    // Side-by-side view (like Bitbucket side-by-side diff)
    function updateSideBySideView() {
      if (!textADisplay || !textBDisplay) return;

      const textAValue = textA.value;
      const textBValue = textB.value;

      const diffs = diffLines(textAValue, textBValue);
      const linesA: string[] = [];
      const linesB: string[] = [];
      const lineNumbersAArray: string[] = [];
      const lineNumbersBArray: string[] = [];

      let lineNumA = 0;
      let lineNumB = 0;

      diffs.forEach(part => {
        // Split by newline
        const lines = part.value.split('\n');

        // Process each line, handling empty lines correctly
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          // Skip the last empty line if it's just a trailing newline from split
          if (
            i === lines.length - 1 &&
            line === '' &&
            !part.value.endsWith('\n')
          ) {
            continue;
          }

          if (part.added) {
            lineNumB++;
            linesA.push('');
            linesB.push(line);
            lineNumbersAArray.push('<div class="line-num-empty"></div>');
            lineNumbersBArray.push(
              `<div class="line-num-added">${lineNumB}</div>`,
            );
          } else if (part.removed) {
            lineNumA++;
            linesA.push(line);
            linesB.push('');
            lineNumbersAArray.push(
              `<div class="line-num-removed">${lineNumA}</div>`,
            );
            lineNumbersBArray.push('<div class="line-num-empty"></div>');
          } else {
            lineNumA++;
            lineNumB++;
            linesA.push(line);
            linesB.push(line);
            lineNumbersAArray.push(`<div>${lineNumA}</div>`);
            lineNumbersBArray.push(`<div>${lineNumB}</div>`);
          }
        }
      });

      // Render left panel (old)
      const fragmentA = document.createDocumentFragment();
      linesA.forEach((line, idx) => {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'diff-line-side';
        if (line === '') {
          lineDiv.className += ' diff-line-empty';
        } else if (linesB[idx] === '') {
          lineDiv.className += ' diff-line-removed';
        } else {
          lineDiv.className += ' diff-line-unchanged';
        }
        const contentSpan = document.createElement('span');
        contentSpan.className = 'diff-line-content';
        contentSpan.textContent = line;
        lineDiv.appendChild(contentSpan);
        fragmentA.appendChild(lineDiv);
      });
      textADisplay.innerHTML = '';
      textADisplay.appendChild(fragmentA);

      // Render right panel (new)
      const fragmentB = document.createDocumentFragment();
      linesB.forEach((line, idx) => {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'diff-line-side';
        if (line === '') {
          lineDiv.className += ' diff-line-empty';
        } else if (linesA[idx] === '') {
          lineDiv.className += ' diff-line-added';
        } else {
          lineDiv.className += ' diff-line-unchanged';
        }
        const contentSpan = document.createElement('span');
        contentSpan.className = 'diff-line-content';
        contentSpan.textContent = line;
        lineDiv.appendChild(contentSpan);
        fragmentB.appendChild(lineDiv);
      });
      textBDisplay.innerHTML = '';
      textBDisplay.appendChild(fragmentB);

      // Update line numbers
      if (lineNumbersToggle?.checked) {
        if (lineNumbersA) lineNumbersA.innerHTML = lineNumbersAArray.join('');
        if (lineNumbersB) lineNumbersB.innerHTML = lineNumbersBArray.join('');
      } else {
        if (lineNumbersA) lineNumbersA.innerHTML = '';
        if (lineNumbersB) lineNumbersB.innerHTML = '';
      }
    }

    function handleInput() {
      if (currentView === 'combined') {
        updateCombinedView();
      } else {
        updateSideBySideView();
      }

      if (lineNumbersToggle?.checked) {
        updateLineNumbers(textA.value, lineNumbersAInput);
        updateLineNumbers(textB.value, lineNumbersBInput);
      }
    }

    // View toggle
    viewCombinedBtn?.addEventListener('click', () => {
      currentView = 'combined';
      viewCombinedBtn.classList.add('active');
      viewSideBySideBtn?.classList.remove('active');
      combinedView?.classList.add('active');
      sideBySideView?.classList.remove('active');
      handleInput();
    });

    viewSideBySideBtn?.addEventListener('click', () => {
      currentView = 'side-by-side';
      viewSideBySideBtn.classList.add('active');
      viewCombinedBtn?.classList.remove('active');
      sideBySideView?.classList.add('active');
      combinedView?.classList.remove('active');
      handleInput();
    });

    // Update diff on input
    textA.addEventListener('input', handleInput);
    textB.addEventListener('input', handleInput);

    // Line numbers toggle
    lineNumbersToggle?.addEventListener('change', () => {
      const show = lineNumbersToggle.checked;
      document
        .querySelectorAll('.line-numbers, .line-numbers-combined')
        .forEach(el => {
          (el as HTMLElement).style.display = show ? 'block' : 'none';
        });
      if (show) {
        handleInput();
      }
    });

    // Clear both
    clearBothBtn?.addEventListener('click', () => {
      textA.value = '';
      textB.value = '';
      handleInput();
    });

    // Swap texts
    swapTextsBtn?.addEventListener('click', () => {
      const temp = textA.value;
      textA.value = textB.value;
      textB.value = temp;
      handleInput();
    });

    // Copy functions
    const setupCopyButton = (btn: HTMLElement | null, text: string) => {
      btn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(text);
          const button = btn as HTMLButtonElement;
          const originalText = button.textContent;
          button.textContent = 'Copied!';
          setTimeout(() => {
            button.textContent = originalText;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
    };

    setupCopyButton(copyTextABtn, textA.value);
    setupCopyButton(copyTextBBtn, textB.value);
    setupCopyButton(copyTextAInputBtn, textA.value);
    setupCopyButton(copyTextBInputBtn, textB.value);

    // Update copy button handlers when text changes
    textA.addEventListener('input', () => {
      // Re-setup copy handlers with new text
      if (copyTextAInputBtn) {
        copyTextAInputBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(textA.value);
            const btn = copyTextAInputBtn as HTMLButtonElement;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => {
              btn.textContent = originalText;
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        };
      }
      handleInput();
    });

    textB.addEventListener('input', () => {
      if (copyTextBInputBtn) {
        copyTextBInputBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(textB.value);
            const btn = copyTextBInputBtn as HTMLButtonElement;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => {
              btn.textContent = originalText;
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        };
      }
      handleInput();
    });

    // Initial render
    handleInput();
  }

  // Initialize when component is ready
  function initializeComponent() {
    const container = document.querySelector('.text-compare-wrapper');
    if (container) {
      // Check if already visible
      const rect = container.getBoundingClientRect();
      const isVisible = rect.top < window.innerHeight && rect.bottom > 0;

      if (isVisible) {
        initTextCompare();
      } else {
        const observer = new IntersectionObserver(
          entries => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                initTextCompare();
                observer.disconnect();
              }
            });
          },
          { threshold: 0.1 },
        );
        observer.observe(container);
      }
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeComponent);
  } else {
    initializeComponent();
  }
</script>

<style>
  .text-compare-wrapper {
    max-width: 1400px;
    margin: 0 auto;
  }

  .tool-header {
    margin-bottom: var(--space-6);
    text-align: center;
  }

  .tool-header h2 {
    font-size: var(--font-size-2xl);
    margin-bottom: var(--space-2);
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .tool-description {
    color: var(--text);
    opacity: 0.8;
    font-size: var(--font-size-base);
  }

  .compare-controls {
    display: flex;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }

  .view-toggle {
    display: flex;
    gap: var(--space-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-m);
    padding: 2px;
    background: var(--muted);
  }

  .view-button {
    background: transparent;
    border: none;
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-s);
    font-size: var(--font-size-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--text);
    font-weight: var(--font-weight-normal);
  }

  .view-button:hover {
    background: var(--bg);
  }

  .view-button.active {
    background: var(--primary);
    color: white;
    font-weight: var(--font-weight-bold);
  }

  .diff-view {
    display: none;
    margin-bottom: var(--space-6);
  }

  .diff-view.active {
    display: block;
  }

  .text-compare-inputs {
    margin-top: var(--space-6);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
  }

  .control-button {
    background: var(--primary);
    color: white;
    border: none;
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-m);
    font-size: var(--font-size-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: var(--font-weight-bold);
  }

  .control-button:hover {
    background: var(--accent);
    transform: translateY(-1px);
  }

  .line-numbers-toggle {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
    font-size: var(--font-size-sm);
    color: var(--text);
  }

  .line-numbers-toggle input[type='checkbox'] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--primary);
  }

  .text-compare-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
    margin-bottom: var(--space-6);
  }

  .compare-panel {
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border);
    border-radius: var(--radius-l);
    overflow: hidden;
    background: var(--bg);
    box-shadow: var(--shadow-1);
    min-height: 400px;
  }

  .compare-wrapper {
    position: relative;
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  .line-numbers {
    background: var(--muted);
    color: var(--text);
    opacity: 0.5;
    padding: 0 var(--space-2);
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    line-height: 1.6;
    text-align: right;
    user-select: none;
    border-right: 1px solid var(--border);
    min-width: 50px;
    overflow-y: scroll;
    overflow-x: hidden;
    flex-shrink: 0;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .line-numbers::-webkit-scrollbar {
    display: none;
  }

  .line-numbers::before {
    content: '';
    display: block;
    height: var(--space-4);
    flex-shrink: 0;
  }

  .line-numbers div {
    height: 1.6em;
    line-height: 1.6em;
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }

  .line-numbers-combined {
    background: var(--muted);
    color: var(--text);
    opacity: 0.7;
    padding: var(--space-4) 0;
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    line-height: 1.6;
    text-align: right;
    user-select: none;
    border-right: 1px solid var(--border);
    min-width: 90px;
    overflow-y: scroll;
    overflow-x: hidden;
    scrollbar-width: none;
    -ms-overflow-style: none;
    flex-shrink: 0;
    height: 100%;
  }

  .line-numbers-combined::-webkit-scrollbar {
    display: none;
  }

  :global(.line-numbers-combined .line-num-both) {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-1);
    min-height: 1.6em;
    line-height: 1.6em;
    padding: 0 var(--space-2);
    position: relative;
  }

  :global(.line-numbers-combined .line-num-both::after) {
    content: '';
    position: absolute;
    left: 50%;
    top: 10%;
    bottom: 10%;
    width: 1px;
    background: var(--border);
    transform: translateX(-50%);
    opacity: 0.6;
  }

  :global(.line-numbers-combined .line-num-both .line-num-old-value),
  :global(.line-numbers-combined .line-num-both .line-num-new-value) {
    flex: 1;
    text-align: center;
    min-width: 0;
    display: inline-block !important;
    opacity: 0.8;
    font-size: var(--font-size-sm);
    line-height: 1.6;
    visibility: visible !important;
  }

  :global(.line-numbers-combined .line-num-both .line-num-old-value) {
    text-align: right;
    padding-right: var(--space-1);
  }

  :global(.line-numbers-combined .line-num-both .line-num-new-value) {
    text-align: left;
    padding-left: var(--space-1);
  }

  .line-numbers-combined .line-num-old,
  .line-numbers-combined .line-num-new {
    min-height: 1.6em;
    line-height: 1.6em;
    text-align: center;
    padding: 0 var(--space-2);
    display: block;
    width: 100%;
    opacity: 0.8;
  }

  .line-numbers .line-num-empty {
    min-height: 1.6em;
    line-height: 1.6em;
    display: block;
    width: 100%;
  }

  .line-numbers .line-num-added {
    color: #28a745;
    font-weight: var(--font-weight-bold);
  }

  .line-numbers .line-num-removed {
    color: #dc3545;
    font-weight: var(--font-weight-bold);
  }

  .line-numbers .line-num-old,
  .line-numbers .line-num-new {
    line-height: 1.6em;
  }

  /* Dark theme line number colors */
  :root[data-theme='dark'] .line-numbers .line-num-added {
    color: #6cff8f;
  }

  :root[data-theme='dark'] .line-numbers .line-num-removed {
    color: #ff6b7a;
  }

  /* Combined view line number colors */
  .line-numbers-combined .line-num-added {
    color: #28a745;
    font-weight: var(--font-weight-bold);
  }

  .line-numbers-combined .line-num-removed {
    color: #dc3545;
    font-weight: var(--font-weight-bold);
  }

  :root[data-theme='dark'] .line-numbers-combined .line-num-added {
    color: #6cff8f;
  }

  :root[data-theme='dark'] .line-numbers-combined .line-num-removed {
    color: #ff6b7a;
  }

  .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) var(--space-4);
    background: var(--muted);
    border-bottom: 1px solid var(--border);
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-sm);
    color: var(--text);
  }

  .copy-button {
    background: var(--primary);
    color: white;
    border: none;
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-s);
    font-size: var(--font-size-xs);
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: var(--font-weight-bold);
  }

  .copy-button:hover {
    background: var(--accent);
    transform: translateY(-1px);
  }

  .compare-input {
    flex: 1;
    padding: var(--space-4);
    padding-top: 0;
    margin-top: var(--space-4);
    border: none;
    resize: none;
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    line-height: 1.6;
    background: var(--bg);
    color: var(--text);
    outline: none;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .diff-result {
    border: 1px solid var(--border);
    border-radius: var(--radius-l);
    overflow: hidden;
    background: var(--bg);
    box-shadow: var(--shadow-1);
    min-height: 200px;
  }

  .diff-wrapper {
    position: relative;
    display: flex;
    min-height: 150px;
    max-height: 600px;
    overflow: hidden;
  }

  .diff-output {
    flex: 1;
    padding: var(--space-4) 0;
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    line-height: 1.6;
    overflow-y: auto;
    overflow-x: auto;
  }

  .diff-line {
    display: flex;
    padding: 0 var(--space-4);
    min-height: 1.6em;
    border-left: 3px solid transparent;
    align-items: center;
  }

  .diff-line-marker {
    display: inline-block;
    width: 24px;
    text-align: center;
    margin-right: var(--space-2);
    font-weight: var(--font-weight-bold);
    user-select: none;
    flex-shrink: 0;
    font-size: var(--font-size-sm);
  }

  .diff-line-content {
    flex: 1;
    white-space: pre;
    word-break: break-all;
    color: inherit;
  }

  /* GitHub-style colors for light theme - exact GitHub colors */
  :global(.diff-line-added) {
    background: #e6ffed !important;
    border-left: 3px solid #28a745 !important;
  }

  :global(.diff-line-added),
  :global(.diff-line-added *) {
    color: #24292e !important;
  }

  :global(.diff-line-added .diff-line-marker) {
    color: #28a745 !important;
    font-weight: var(--font-weight-bold);
  }

  :global(.diff-line-removed) {
    background: #ffeef0 !important;
    border-left: 3px solid #dc3545 !important;
  }

  :global(.diff-line-removed),
  :global(.diff-line-removed *) {
    color: #24292e !important;
  }

  :global(.diff-line-removed .diff-line-marker) {
    color: #dc3545 !important;
    font-weight: var(--font-weight-bold);
  }

  .diff-line-unchanged {
    background: var(--bg) !important;
    color: var(--text) !important;
  }

  .diff-line-unchanged .diff-line-marker {
    color: var(--text) !important;
    opacity: 0.4;
  }

  .diff-line-unchanged .diff-line-content {
    color: var(--text) !important;
  }

  /* Dark theme adjustments */
  :root[data-theme='dark'] .diff-view .diff-line-added {
    background: rgba(40, 167, 69, 0.2) !important;
    border-left: 3px solid #28a745 !important;
  }

  :root[data-theme='dark'] .diff-view .diff-line-added,
  :root[data-theme='dark'] .diff-view .diff-line-added * {
    color: #6cff8f !important;
  }

  :root[data-theme='dark'] .diff-view .diff-line-removed {
    background: rgba(220, 53, 69, 0.2) !important;
    border-left: 3px solid #dc3545 !important;
  }

  :root[data-theme='dark'] .diff-view .diff-line-removed,
  :root[data-theme='dark'] .diff-view .diff-line-removed * {
    color: #ff6b7a !important;
  }

  /* Side-by-side view styles */
  .compare-display {
    flex: 1;
    padding: var(--space-4) 0;
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    line-height: 1.6;
    overflow-y: auto;
    overflow-x: auto;
    background: var(--bg);
    color: var(--text);
  }

  .diff-line-side {
    display: flex;
    padding: 0 var(--space-4);
    min-height: 1.6em;
    border-left: 3px solid transparent;
    align-items: center;
  }

  /* GitHub-style colors for side-by-side view - light theme */
  :global(.diff-line-side.diff-line-added) {
    background: #e6ffed !important;
    border-left: 3px solid #28a745 !important;
  }

  :global(.diff-line-side.diff-line-added),
  :global(.diff-line-side.diff-line-added *) {
    color: #24292e !important;
  }

  :global(.diff-line-side.diff-line-removed) {
    background: #ffeef0 !important;
    border-left: 3px solid #dc3545 !important;
  }

  :global(.diff-line-side.diff-line-removed),
  :global(.diff-line-side.diff-line-removed *) {
    color: #24292e !important;
  }

  :global(.diff-line-side.diff-line-unchanged) {
    background: var(--bg) !important;
    color: var(--text) !important;
  }

  :global(.diff-line-side.diff-line-unchanged .diff-line-content) {
    color: var(--text) !important;
  }

  /* Dark theme adjustments for side-by-side */
  :global(:root[data-theme='dark'] .diff-line-side.diff-line-added) {
    background: rgba(40, 167, 69, 0.2) !important;
    border-left: 3px solid #28a745 !important;
  }

  :global(:root[data-theme='dark'] .diff-line-side.diff-line-added),
  :global(:root[data-theme='dark'] .diff-line-side.diff-line-added *) {
    color: #6cff8f !important;
  }

  :global(:root[data-theme='dark'] .diff-line-side.diff-line-removed) {
    background: rgba(220, 53, 69, 0.2) !important;
    border-left: 3px solid #dc3545 !important;
  }

  :global(:root[data-theme='dark'] .diff-line-side.diff-line-removed),
  :global(:root[data-theme='dark'] .diff-line-side.diff-line-removed *) {
    color: #ff6b7a !important;
  }

  :global(.diff-line-side.diff-line-empty) {
    background: var(--muted);
    min-height: 1.6em;
  }

  .diff-line-side.diff-line-empty .diff-line-content {
    color: transparent;
  }

  .diff-placeholder {
    color: var(--text);
    opacity: 0.5;
    text-align: center;
    padding: var(--space-8);
    font-style: italic;
  }

  @media (max-width: 900px) {
    .text-compare-container,
    .text-compare-inputs {
      grid-template-columns: 1fr;
    }

    .compare-panel {
      min-height: 300px;
    }

    .view-toggle {
      width: 100%;
      justify-content: center;
    }
  }
</style>
